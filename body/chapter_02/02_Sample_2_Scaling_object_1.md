# 2-2. サンプル2: オブジェクトを拡大・縮小する1

## 作成するアドオンの仕様

今回作成するアドオンの使用は、以下のようにします。

* **3Dビュー** のメニュー **オブジェクト** に *選択オブジェクトの拡大* と *選択オブジェクトの縮小* を追加
* 追加した *選択オブジェクトの拡大* を実行すると、選択中のオブジェクトの大きさが2倍になる
* 追加した *選択オブジェクトの縮小* を実行すると、選択中のオブジェクトの大きさが1/2倍になる

## アドオンを作成する

以下のソースコードを、 [1.4節](../chapter_01/04_Install_own_Add-on.md)を参考にして **テキスト・エディタ** に入力し、
**sample_2.py** という名前で保存してください。

{% include "../../sample/src/chapter_02/sample_2.py" %}

## アドオンを実行する

作成したアドオンを使ってみましょう。

### アドオンを有効化する

[1.4節](../chapter_01/04_Install_own_Add-on.md)を参考に、作成したアドオンを有効化してみましょう。
イ正常に終了すると、 **コンソール** に以下の文字列が出力されるはずです。

```sh
サンプル 2: アドオン「サンプル2」が有効化されました。
```

### アドオンの機能を使ってみる

アドオンを有効化したら、 **3Dビュー** のメニューに **オブジェクト** > **選択オブジェクトの拡大** と
**オブジェクト** > **選択オブジェクトの縮小** が追加されていることを確認します。

＠＠＠図を追加＠＠＠

Blender起動直後には **Cube** が生成されているはずなので、選択します。

＠＠＠図を追加＠＠＠

まず最初に **3Dビュー** の **オブジェクト** > **選択オブジェクトの拡大** を実行してみましょう。
選択したオブジェクト **Cube** のサイズが2倍に拡大されたことを確認してください。

＠＠＠図を追加＠＠＠

この時、 **コンソール・ウィンドウ** を見てください。
以下のメッセージが出力されていると思います。

```sh
サンプル 2: 「Cube」を2倍に拡大しました。
```

また、 **コンソール** には以下のメッセージが出力されているはずです。

```sh
サンプル 2: オペレーション「OBJECT_OT_enlarge_object」が実行されました。
```

次に **3Dビュー** の **オブジェクト** > **選択オブジェクトの縮小** を実行してみましょう。
選択したおbジェクト **Cube** のサイズが1/2倍に縮小されたことが確認できます。

＠＠＠図を追加＠＠＠

**コンソール・ウィンドウ** には、以下のメッセージが出力されていると思います。

```sh
サンプル 2: 「Cube」を1/2倍に縮小しました。
```

また、 **コンソール** には以下のメッセージが出力されているはずです。

```sh
サンプル 2: オペレーション「OBJECT_OT_reduce_object」が実行されました。
```

### アドオンを無効化する

[1.4節](../chapter_01/04_Install_own_Add-on.md)を参考に、有効化したアドオンを無効化してください。
アドオンが無効化されると、 **コンソール** に以下の文字列が出力されるはずです。

```sh
サンプル 2: アドオン「サンプル 2」が無効化されました。
```

## ソースコードの解説

前回説明した内容以外で、新しく追加された部分について説明します。

### 複数のオペレーションクラスの定義

1つのファイルに複数のオペレーションを作成したい場合は、作りたいオペレーションの数だけオペレーションクラスを作成します。
今回はオブジェクトの拡大と縮小のために、2つのオペーレーションクラスを以下のように作成します。

```py:sample_2_part1.py
# オブジェクトを拡大するオペレーション
class EnlargeObject(bpy.types.Operator):

	bl_idname = "object.enlarge_object"
	bl_label = "選択オブジェクトの拡大"
	bl_description = "選択中のオブジェクトを拡大します"
	bl_options = {'REGISTER', 'UNDO'}

# ・・・(略)・・・


# オブジェクトを縮小するオペレーション
class ReduceObject(bpy.types.Operator):

	bl_idname = "object.reduce_object"
	bl_label = "選択オブジェクトの縮小"
	bl_description = "選択中のオブジェクトを縮小します"
	bl_options = {'REGISTER', 'UNDO'}

# ・・・(略)・・・
```

```bl_idname``` はオペレーションごとに固有の文字列でなければならないので、重複しないように気をつけてください。
重複しないようにするための方法は後ほど紹介するので、参考にしてみてください。

### コンソール・ウィンドウへの出力

オペレーションクラスの処理のうち、 選択オブジェクトの拡大を実行した時の処理について解説します。

```py:sample_2_part2.py
    # メニューを実行した時に呼ばれる関数
    def execute(self, context):
        active_obj = context.active_object
        active_obj.scale = active_obj.scale * 2.0
        self.report({'INFO'}, "サンプル 2: 「" + active_obj.name + "」を2倍に拡大しました。")
        print("サンプル 2: オペレーション「" + self.bl_idname + "」が実行されました。")
```

```execute()``` 関数に渡されてくる引数は、 [2-1節](01_Sample_1_Create_object_from_Add-on.md)で説明しましたが、
今回のアドオンではこれらの引数を使っています。
引数 ```context``` を利用することにより、現在のコンテキスト（実行状態）を取得することができます。
```context.active_object``` により現在選択されているオブジェクトを取得し、取得したオブジェクトのサイズを2倍にしています。

今回のアドオンでは、オペレーションを実行した後にユーザへ拡大・縮小したことがわかるようなメッセージを
**コンソール・ウィンドウ** に出力しています。
**コンソール・ウィンドウ** に出力するためには、 ```self.report()``` メソッドを利用します。
```self``` は、オブジェクトのインスタンスです。

```self.report()``` の引数は以下の通りです。

|引数|型|値の説明|
|---|---|---|
|第1引数|ディクショナリ型|出力メッセージの種類|
|第2引数|文字列|メッセージ本文|

**出力メッセージの種類** 、には以下のようなものがあります。





## Pythonコンソールを活用しよう

### bl_idname が重複していないか確認する

先ほどソースコードの解析の中で、 ```bl_idname``` が重複してはならないと書きましたが、 ```bl_idname``` を
重複していないか確認するためにはどのようにしたほうが良いのでしょうか？
ここで役に立つのが、 **Pythonコンソール** です。

**Pythonコンソール** を利用すると、例えば以下のようなことができます。

* 補完機能を使って、APIの正確なスペルや一覧を調べることができる
* APIを実行することで、APIがどのような効果を持つか確認出来る
* 短いPythonのソースを実行し、簡単なテストができる


### Pythonコンソールのショートカットキー

Pythonコンソールには以下のようなショートカットキーが備わっていますので、ぜひ活用してみてください。

|Windows|Mac|Linux|動作|
|----|----|----|----|
|Shift + F4|shift + fn + F4|Shift + F4|Python Consoleを開く|
|↑|↑|↑|過去に入力した履歴を戻る|
|↓|↓|↓|過去に入力した履歴を進める|
|Tab|tab|Tab|インデント|
|Shift + tab|shift + tab|shift + tab|アンインデント|
|Home|⌘ + ←|Home|行頭にカーソルを移動|
|End|⌘ + →|End|行末にカーソルを移動|
|Ctrl + ←|control + ←<br>fn + ←|Ctrl + ←|単語単位で左にカーソルを移動|
|Ctrl + →|control + →<br>fn + →|Ctrl + →|単語単位で右にカーソルを移動|
|Ctrl + Backspace|control + delete|Ctrl + Backspace|カーソルの位置から行頭に向かって単語単位で削除|
|Ctrl + Delete|control + fn + delete|Ctrl + Delete|カーソルの位置から行末に向かって単語単位で削除|
|Shift + Enter|shift + return|Shift + Enter|行を削除|
|Ctrl + Space|control + space|Ctrl + Space|ソースコード補完|
|Ctrl + ↑<br>Ctrl + ↓|control + ↑<br>control + ↓|Ctrl + ↑<br>Ctrl + ↓|コンソールのフルスクリーン化/解除|
|Ctrl + C|control + C|Ctrl + C|選択部分をクリップボードへコピー|
|Ctrl + V|control + V|Ctrl + V|クリップボードからの貼り付け|
|Shift + Ctrl + C|shift + control + C|Shift + Ctrl + C|Python Consoleを開いてから実行されたスクリプトを全てコピー<br>実行結果についてもコピーされるが、行頭に「#~ 」が自動的についてコメント化される|
※ ⌘はMacのcommand

Macでショートカットを利用するためには、Mission Controlなどに標準で割り当たっているcontrolと⌘について以下の手順に沿い、
割り当てを解除する必要があります。

1. 「システム環境設定...」 - をクリック
2. 「キーボード」をクリック
3. 「ショートカット」タブをクリック
4. Blender Python Consoleで使いたいショートカットの割り当てを解除


## まとめ


### ポイント

* オペレーションを複数作るためには、作りたいオペレーションの数だけオペレーションクラスを作成し、
作成した全ての ```bl_idname``` を登録する必要がある
* ```self.report()``` 関数を利用することで、 **コンソール・ウィンドウ** にメッセージを出力することができる
