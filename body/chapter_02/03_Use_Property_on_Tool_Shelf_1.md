<div id="sect_title_img_2_3"></div>

<div id="sect_title_text"></div>

# ツール・シェルフの<br>オプションを活用する①

<div id="preface"></div>

###### これまで2つのサンプルを用いてアドオンの解説を行ってきましたがいかがでしょうか？アドオンの作り方が少しずつわかってきたでしょうか？本節では前節のサンプルを改良し、拡大率をツール・シェルフ から変更できるようにします。

## 作成するアドオンの仕様

* *3Dビュー* エリアのメニュー *オブジェクト* に *選択オブジェクトの拡大* と *選択オブジェクトの縮小* を追加
* 追加した *選択オブジェクトの拡大* を実行すると、選択中のオブジェクトの大きさを *3Dビュー* エリアの *ツール・シェルフ* の *拡大率* で指定した倍率で拡大する（初期値: 2倍）
* 追加した *選択オブジェクトの縮小* を実行すると、選択中のオブジェクトの大きさを *3Dビュー* エリアの *ツール・シェルフ* の *縮小率* で指定した倍率で縮小する（初期値: 1/2倍）

### ツール・シェルフとは？

*ツール・シェルフ* は、 *3Dビュー* エリアの左端に表示されるツール群を指し、 ```T``` キーにより表示/非表示を切り替えることができます。

![ツールシェルフ](https://dl.dropboxusercontent.com/s/ys4r22wz8lvimpn/tool-shelf.png "ツールシェルフ")

何かしら操作を行う度に *ツール・シェルフ* の下側にパラメータ設定のためのUIが表示されます。
直前に行った操作に対し、細かいパラメータを指定する時に使われます。

今回作成するアドオンでは、*ツール・シェルフ* から *拡大率* や *縮小率* を指定できるようにします。

## アドオンを作成する

以下のソースコードを、 [1-4節](../chapter_01/04_Install_own_Add-on.md)を参考にして *テキスト・エディタ* に入力し、 ```sample_3.py``` という名前で保存してください。

[import](../../sample/src/chapter_02/sample_3.py)

## アドオンを実行する

### アドオンを有効化する

[1-4節](../chapter_01/04_Install_own_Add-on.md)を参考に、作成したアドオンを有効化しましょう。
アドオンを有効化すると、 *コンソール* に以下の文字列が出力されるはずです。

```shell-session
サンプル 3: アドオン「サンプル3」が有効化されました。
```

*3Dビュー* のエリアのメニューに *オブジェクト* > *選択オブジェクトの拡大（拡大率任意指定）* と *オブジェクト* > *選択オブジェクトの縮小（縮小率任意指定）* が追加されていることを確認します。

![メニューの追加確認](https://dl.dropboxusercontent.com/s/e97r8hbr4kxr8ef/use_add-on_1.png "メニューの追加確認")

### アドオンの機能を使ってみる

以下の手順に従い、作成したアドオンの機能を使ってみましょう。

<div id="process_title"></div>

##### Work

<div id="process_noimg"></div>

|1|Blender起動直後に生成される *Cube* を選択します。|
|---|---|

<div id="process_sep"></div>

---

<div id="process"></div>

|2|*3Dビュー* エリアのメニュー *オブジェクト* > *選択オブジェクトの拡大（拡大率任意指定）* を実行すると、選択したオブジェクト *Cube* のサイズが2倍に拡大されたはずです。この状態で *ツール・シェルフ* の下側を見てください。*選択オブジェクトの拡大（拡大率任意指定）* のラベルの下に *拡大率* というオプションが追加され、数値を入力できるようになっています。|![選択オブジェクトの拡大1](https://dl.dropboxusercontent.com/s/q989u68qznr9j10/use_add-on_2.png "選択オブジェクトの拡大1")|
|---|---|---|

<div id="process_sep"></div>

---

<div id="process"></div>

|3|*拡大率* の数値を好きな値に変更します。指定した *拡大率* の値に応じて、オブジェクトの拡大率が変わりますまた、数値変更の度に拡大したことを示すメッセージが *コンソール・ウィンドウ* に表示されます。|![選択オブジェクトの拡大2](https://dl.dropboxusercontent.com/s/nvtlavprah8elk5/use_add-on_3.png "選択オブジェクトの拡大2")|
|---|---|---|

<div id="process_sep"></div>

---

<div id="process_noimg"></div>

|4|*3Dビュー* エリアのメニュー *オブジェクト* > *選択オブジェクトの縮小（縮小率任意指定）* を実行すると、 *ツール・シェルフ* の *選択オブジェクトの縮小（縮小率任意指定）* ラベルの下に、 *縮小率* というオプションが追加されます。|
|---|---|

<div id="process_sep"></div>

---

<div id="process"></div>

|5|*縮小率* の数値を変更することで、オブジェクトの縮小率を変えることができます。|![選択オブジェクトの縮小](https://dl.dropboxusercontent.com/s/yiktzp7fbujdumn/use-add-on_4.png "選択オブジェクトの縮小")|
|---|---|---|

<div id="process_start_end"></div>

---


### アドオンを無効化する

[1-4節](../chapter_01/04_Install_own_Add-on.md) を参考に、有効化したアドオンを無効化します。
アドオンが無効化されると、 *コンソール* に以下の文字列が出力されます。

```shell-session
サンプル 3: アドオン「サンプル 3」が無効化されました。
```

## ソースコードの解説

作成したアドオンのソースコードを解説します。

### オプションの作成

*ツール・シェルフ* のオプションから直前に行った処理に対して調整できるようにするためには、オペレータクラスのメンバに ```bpy.props``` に定義されているプロパティクラスを利用します。
プロパティクラスには *ツール・シェルフ* のオプション作成に使用する以外にも存在しますが、オプションとして指定できるのは以下に示したものだけとなります。

|クラス名|型|
|---|---|
|```IntProperty```|整数|
|```IntVectorProperty```|整数（グループ）|
|```FloatProperty```|浮動小数点|
|```FloatVectorProperty```|浮動小数点（グループ）|
|```StringProperty```|文字列|
|```BoolProperty```|ブーリアン <br> Blender上では *セレクトボックス* のUIとなる|
|```BoolVectorProperty```|ブーリアン（グループ）|
|```EnumProperty```|列挙 <br> Blender上では *リストボックス* のUIとなる|

プロパティクラス作成時に引数を指定することで、クラスの設定をユーザが決めることができます。
以下に代表的な引数を示しますが、クラスによっては引数に指定できないものもあります。

|引数|値の説明|
|---|---|
|```name```|ツール・シェルフに表示されるオプション名|
|```description```|オプションの説明文|
|```default```|オプションのデフォルト値|
|```max```|オプションに指定できる最大値|
|```min```|オプションに指定できる最小値|

今回は以下のように、 ```FloatPropery``` クラスを用いて拡大率と縮小率を指定できるようにしています。

```python
magnification = FloatProperty(
  name = "拡大率",
  description = "拡大率を設定します",
  default = 2.0,
  min = 1.0,
  max = 10.0
)

# ・・・（略）・・・

reduction = FloatProperty(
  name = "縮小率",
  description = "縮小率を設定します",
  default = 0.5,
  min = 0.001,
  max = 1.0
)
```

ここでは、 *オブジェクト* > *選択オブジェクトの拡大（拡大率任意指定）* に絞って解説していきます。
引数 ```name``` はオプションの名称で、 ```拡大率``` を指定しています。
引数 ```description ``` はオプションをマウスオーバーした時に表示される説明文が指定されています。
引数 ```default``` には ```2.0``` を指定しているため、拡大率2.0倍を初期値として実行します。
この状態で拡大率を増加させていくと、拡大率は引数 ```max``` に指定した ```10.0``` 倍まで大きくすることがわかります。
一方拡大率を減少させていくと、引数 ```min``` に指定した ```1.0``` 倍まで拡大率を小さくすることができます。

オプションの値を変更すると、オペレータクラスの ```execute()``` メソッドが実行されます。
今回のように値を連続的に変更できるようなオプションを作成した場合、値が変更される度に ```execute()``` メソッドが呼ばれてしまいます。
```execute()``` メソッドの処理が重い場合は値の変更だけで時間がかかるので、 ```execute()``` メソッドは可能な限り処理が軽くなるようにしましょう。
```execute()``` 関数の中で指定されたオプションの値は、以下のように通常のメンバ変数と同様、 ```self``` 変数からアクセスすることで取得できます。

```python
        active_obj.scale = active_obj.scale * self.reduction
```

## まとめ

事前に実行した操作に対して、ユーザが *ツール・シェルフ* のオプションから細かい制御をできるようにするための方法を紹介しました。
ここでは浮動小数点数の値を指定できるオプションのみを紹介しましたが、他にも整数やブーリアンなどでもオプションを指定できます。
ぜひ一度使ってみてください。

<div id="point"></div>

### ポイント

<div id="point_item"></div>

* ユーザが直前に実行した操作に対するパラメータを、*ツール・シェルフ* のオプションから制御することができる
* *ツール・シェルフ* のオプションによる制御を可能とするためには、オペレーションクラスのメンバ変数にプロパティクラスを持たせる必要がある
* *ツール・シェルフ* のオプションに指定した値を変更すると、値の変更の度にオペレーションクラスの ```execute()``` メソッドが実行される
