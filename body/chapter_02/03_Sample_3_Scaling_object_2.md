# 2-3. サンプル3: オブジェクトを拡大・縮小する2 ツール・シェルフを使ってみよう

これまでサンプルを用いてアドオンの解説を行ってきましたがいかがでしょうか？
アドオンの作り方が少しずつ掴めてきたのではないでしょうか？
本節では [2.2節](02_Sample_2_Scaling_object_1.md) を改良し、拡大率を **ツール・シェルフ** から変更できるようにしてみます。

## 作成するアドオンの仕様

* **3Dビュー** のメニュー **オブジェクト** に *選択オブジェクトの拡大* と *選択オブジェクトの縮小* を追加
* 追加した *選択オブジェクトの拡大* を実行すると、選択中のオブジェクトの大きさを **3Dビュー** の **ツール・シェルフ** の *拡大率* で指定した倍率で拡大する（初期値: 2倍）
* 追加した *選択オブジェクトの縮小* を実行すると、選択中のオブジェクトの大きさを **3Dビュー** の **ツール・シェルフ** の *縮小率* で指定した倍率で縮小する（初期値: 1/2倍）

### ツール・シェルフとは？

**ツール・シェルフ** とは、 **3Dビュー** ウィンドウの左端に表示されたツール群を指します。
**ツール・シェルフ** は ```T``` キーにより表示/非表示を切り替えることができます。

![ツールシェルフ](https://dl.dropboxusercontent.com/s/ys4r22wz8lvimpn/tool-shelf.png "ツールシェルフ")

何かしら操作を行う度に **ツール・シェルフ** の下側にパラメータ設定のためのUIが表示されますが、
操作に対する細かいパラメータを指定する時に使われます。
今回作成するアドオンでは、ここから **拡大率** や **縮小率** を指定できるようにします。

## アドオンを作成する

以下のソースコードを、 [1.4節](../chapter_01/04_Install_own_Add-on.md)を参考にして **テキスト・エディタ** に入力し、
**sample_3.py** という名前で保存してください。

[import](../../sample/src/chapter_02/sample_3.py)

## アドオンを実行する

作成したアドオンを使ってみよう。

### アドオンを有効化する

[1.4節](../chapter_01/04_Install_own_Add-on.md)を参考に、作成したアドオンを有効化してみましょう。
正常に終了すると、 **コンソール** に以下の文字列が出力されるはずです。

```sh
サンプル 3: アドオン「サンプル3」が有効化されました。
```

### アドオンの機能を使ってみる

アドオンを有効化したら、 **3Dビュー** のメニューに **オブジェクト** > **選択オブジェクトの拡大（拡大率任意指定）** と
**オブジェクト** > **選択オブジェクトの縮小（縮小率任意指定）** が追加されていることを確認します。

![メニューの追加確認](https://dl.dropboxusercontent.com/s/e97r8hbr4kxr8ef/use_add-on_1.png "メニューの追加確認")

Blender起動直後に生成される **Cube** を選択し、 **3Dビュー** の **オブジェクト** > **選択オブジェクトの拡大（拡大率任意指定）** を実行してみましょう。
選択したオブジェクト **Cube** のサイズが2倍に拡大されたと思います。
次に **ツール・シェルフ** の下側を見てください。
**選択オブジェクトの拡大（拡大率任意指定）** の下に、 **拡大率** というオプションが追加されています。

![選択オブジェクトの拡大1](https://dl.dropboxusercontent.com/s/q989u68qznr9j10/use_add-on_2.png "選択オブジェクトの拡大1")

**拡大率** の数値を好きなように変更してみましょう。
**拡大率** の値に応じて、オブジェクトが拡大率が変わることが確認できます。
また、拡大したことを示すメッセージが **コンソール・ウィンドウ** に表示されます。

![選択オブジェクトの拡大2](https://dl.dropboxusercontent.com/s/nvtlavprah8elk5/use_add-on_3.png "選択オブジェクトの拡大2")

続いて、 **3Dビュー** の **オブジェクト** > **選択オブジェクトの縮小（縮小率任意指定）** を実行してみましょう。
**ツール・シェルフ** の **選択オブジェクトの縮小（縮小率任意指定）** の下に、 **縮小率** というオプションが追加されています。
**縮小率** の数値を変更することで、オブジェクトの縮小率を変えることができます。

![選択オブジェクトの縮小](https://dl.dropboxusercontent.com/s/yiktzp7fbujdumn/use-add-on_4.png "選択オブジェクトの縮小")

### アドオンを無効化する

[1.4節](../chapter_01/04_Install_own_Add-on.md)を参考に、有効化したアドオンを無効化してください。
アドオンが無効化されると、 **コンソール** に以下の文字列が出力されるはずです。

```sh
サンプル 3: アドオン「サンプル 3」が無効化されました。
```

## ソースコードの解説

作成したアドオンのソースコードを解説します。

### オプションの作成

**ツール・シェルフ** のオプションからオペレーションの制御をできるようにするためには、 **オペレーション・クラス**
のメンバに ```bpy.props``` に定義されている **〜Property** クラスを利用します。
オプションとして作成できる **〜Property** クラスには、型ごとに以下のような種類があります。
**〜Property** クラスは他にもありますが、オプションとして指定できるのは以下に示したもののみです。

|クラス名|型|
|---|---|
|```IntProperty```|整数|
|```IntVectorProperty```|整数（グループ）|
|```FloatProperty```|浮動小数点|
|```FloatVectorProperty```|浮動小数点（グループ）|
|```StringProperty```|文字列|
|```BoolProperty```|ブーリアン <br> Blender上では *セレクトボックス* のUIとなる|
|```BoolVectorProperty```|ブーリアン（グループ）|
|```EnumProperty```|列挙 <br> Blender上では *リストボックス* のUIとなる|

クラス作成時に引数を指定することで、クラスの設定をユーザが決めることができます。
以下に代表的な引数を示しますが、クラスによって引数に指定できないものもあります。

|引数|値の説明|
|---|---|
|```name```|ツール・シェルフに表示されるオプション名|
|```description```|オプションの説明文|
|```default```|オプションのデフォルト値|
|```max```|オプションに指定できる最大値|
|```min```|オプションに指定できる最小値|

今回は以下のように、 **FloatProperyクラス** を用いて拡大率と縮小率を指定できるようにしています。

```py:sample_3_part1.py
magnification = FloatProperty(
  name = "拡大率",
  description = "拡大率を設定します",
  default = 2.0,
  min = 1.0,
  max = 10.0
)

# ・・・（略）・・・

reduction = FloatProperty(
  name = "縮小率",
  description = "縮小率を設定します",
  default = 0.5,
  min = 0.001,
  max = 1.0
)
```

**オブジェクト** > **選択オブジェクトの縮小（縮小率任意指定）** を見てみましょう。
引数 ```name``` はオプションの名称で、 ```拡大率``` と表示されていることがわかります。
引数 ```description ``` はオプションをマウスオーバーした時に表示される説明文です。
引数 ```default``` には拡大率の場合に ```2.0``` を指定しているため、拡大率2.0倍が初期値を初期値として実行されているはずです。
この状態で拡大率を増加させていくと、拡大率は引数 ```max``` に指定した ```10.0``` 倍まで大きくすることができます。
さらに拡大率を減少させていくと、今度は引数 ```min``` に指定した ```1.0``` 倍まで拡大率を小さくすることができます。

オプションを変更すると、オペレーションクラスの ```execute()``` メソッドが実行されます。
今回のように値を連続的に変更できるようなオプションを作成した場合、値が変更される度に ```execute()``` メソッドが呼ばれてしまいます。
このため ```execute()``` メソッドが処理の重いものであると、値の変更だけでも時間がかかるので、 ```execute()``` メソッドは可能な限り処理が軽くなるようにしましょう。
```execute()``` 関数の中で指定されたオプションの値は、以下のように通常のメンバ変数と同様、 ```self``` からアクセスすることで取得できます。

```py:sample_3_part2.py```
        active_obj.scale = active_obj.scale * self.reduction
```

## まとめ

ユーザが **ツール・シェルフ** のオプションから、オペレーションの細かい制御ができるようにするための方法を紹介しました。
ここでは浮動小数点のオプションのみを紹介しましたが、他にも整数やブーリアンなど便利なオプションがありますので、ぜひ一度使って使い心地を確認してみてください。

### ポイント

* **ツール・シェルフ** のオプションからユーザが直前に行った操作に対し、ユーザ自身が細かいパラメータを制御することができる
* **ツール・シェルフ** のオプションによる制御は、オペレーションクラスのメンバ変数に **〜Property** クラスを持つことで提供できる
* **ツール・シェルフ** のオプションを変更すると、オペレーションクラスの ```execute()``` メソッドが実行される
