<div id="sect_title_img_3_2"></div>

<div id="sect_title_text"></div>

# キーボードのキーイベントを扱う

<div id="preface"></div>

###### [3-1節](../chapter_03/01_Handle_Mouse_Click_Event.md) ではマウスのイベントを扱う方法を説明しました。本節ではキーボードのイベントを扱う方法を、サンプルを交えて紹介します。

## 作成するアドオンの仕様

* *3Dビュー* エリアのプロパティパネルの *特殊オブジェクト編集モード* から、特殊オブジェクト編集モードの開始/終了を切り替えるボタンを配置する
* 特殊オブジェクト編集モードではキーボードのキー入力に応じて、選択されたオブジェクトに対して以下に示す処理を行う

|キー|処理|
|---|---|
|*T* + *X* + *→*|X軸正方向に平行移動|
|*T* + *X* + *←*|X軸負方向に平行移動|
|*T* + *Y* + *→*|Y軸正方向に平行移動|
|*T* + *Y* + *←*|Y軸負方向に平行移動|
|*T* + *Z* + *→*|Z軸正方向に平行移動|
|*T* + *Z* + *←*|Z軸負方向に平行移動|
|*S* + *X* + *→*|X軸方向に拡大|
|*S* + *X* + *←*|X軸方向に縮小|
|*S* + *Y* + *→*|Y軸方向に拡大|
|*S* + *Y* + *←*|Y軸方向に縮小|
|*S* + *Z* + *→*|Z軸方向に拡大|
|*S* + *Z* + *←*|Z軸方向に縮小|
|*R* + *X* + *→*|X軸周りの正方向に回転|
|*R* + *X* + *←*|X軸周りの負方向に回転|
|*R* + *Y* + *→*|Y軸周りの正方向に回転|
|*R* + *Y* + *←*|Y軸周りの負方向に回転|
|*R* + *Z* + *→*|Z軸周りの正方向に回転|
|*R* + *Z* + *←*|Z軸周りの負方向に回転|


## アドオンを作成する

[1-5節](../chapter_01/05_Install_own_Add-on.md) を参考にして以下のソースコードを入力し、ファイル名を ```sample_3-2.py``` として保存してください。


[import](../../sample/src/chapter_03/sample_3-2.py)

## アドオンを使用する

### アドオンを有効化する

[1-5節](../chapter_01/05_Install_own_Add-on.md) を参考に、作成したアドオンを有効化するとコンソールウィンドウに以下の文字列が出力されます。

```sh
サンプル3-2: アドオン「サンプル3-2」が有効化されました。
```

<div id="sidebyside"></div>

|また、プロパティパネルの *特殊オブジェクト編集モード* にボタンが配置されます。||
|---|---|


### アドオンの機能を使用する

<div id="process_title"></div>

##### Work

<div id="process"></div>

|<div id="box">1</div>|*3Dビュー* エリアのプロパティパネル上の *特殊オブジェクト編集モード* に配置されている *開始* ボタンをクリックすると、特殊オブジェクト編集モードに移行します。この時、コンソールウィンドウに以下のメッセージが出力されます。||
|---|---|---|

```sh
サンプル3-2: 特殊オブジェクト編集モードへ移行しました。
```


<div id="process_sep"></div>

---


<div id="process"></div>

|<div id="box">2</div>|本節サンプルの仕様で書いたように、キーボードのキーの組み合わせによりオブジェクトを並進移動、拡大・縮小、回転することができます。||
|---|---|---|


<div id="tips"></div>

本節で紹介するアドオンにはバグがあります。例えば、*S* + *X* を押している状態で *Y* キーを押すて *→* キーを押すとY軸方向にオブジェクトが拡大されますが、*Y* キーを離して *S* キーと *X* キーのみが押されている状態に戻すと、*→* キーや *←* キーによるオブジェクトの拡大・縮小が行えなくなります。アドオンのソースコードを読めばこのバグの原因はわかると思いますが、説明しやすくするために処理を単純化することを考え、バグをそのまま残しています。  
なお、*X* キーを一度離した後に再度 *X* キーを押し直せば、本来期待する動作である *→* キーや *←* キーによるオブジェクトの拡大・縮小を行えるようになります。


<div id="process"></div>

|<div id="box">3</div>|キーボードの *Q* キーを押し、特殊オブジェクト編集モードを終了します。特殊オブジェクト編集モードを終了すると、コンソールウィンドウに以下のメッセージが表示されます。||
|---|---|---|

```sh
サンプル3-2: 通常モードへ移行しました。
```


<div id="process_start_end"></div>

---


### アドオンを無効化する

[1-5節](../chapter_01/05_Install_own_Add-on.md) を参考に有効化したアドオンを無効化すると、コンソールウィンドウに以下の文字列が出力されます。

```sh
サンプル3-2: アドオン「サンプル3-2」が無効化されました。
```


## ソースコードの解説

変数名などの細かい部分が異なるところはありますが、オペレータクラスの ```modal()``` メソッドの処理を除いて [3-1節](01_Handle_Mouse_Click_Event.md) の内容とほとんど同じです。このため本節では、オペレータクラス ```SpecialObjectEditMode``` の ```modal()``` メソッドの処理内容について説明します。




## まとめ

本節では、キーボードのキーイベントを扱う方法を紹介しました。[3-1節](01_Handle_Mouse_Click_Event.md) のサンプルと比較すると、マウスのイベントとキーボードのイベントを扱うためには ```modal()``` メソッド、または ```invoke()``` メソッドに渡されてくるイベント情報が格納された引数を用いる点で同じであることを理解していただけたのではないでしょうか。

通常のアドオンの処理と異なり、ユーザからのイベントを扱ってインタラクティブな機能を提供することは、これまでに紹介してきた ```execute()``` メソッドを単に実行する処理と比べて処理が複雑になりがちでバグも発生しやすくなります。しかしキーボードやマウスのイベントを適切に扱うことができれば、アドオンで実現できることがかなり広がります。


<div id="point"></div>

### ポイント

<div id="point_item"></div>

*
