<div id="sect_title_img_4_5"></div>

<div id="sect_title_text"></div>

# アドオンの動作テストを自動化する

<div id="preface"></div>

###### [4-3節](03_Publish_your_Add-on.md) にて説明しましたが、アドオンを公開した後はバグ修正や機能追加などアドオンのサポートをきちんと行うべきです。しかし、アドオンのソースコードを修正する度にアドオンの動作テストを毎回行うのは、特にアドオンの規模が大きくなってくると大変です。本節では、Blenderのコマンドライン実行を活用してアドオンの動作テストを自動化する方法を紹介します。


## アドオンの動作テストを自動化する利点

バグ修正や新機能追加によりソースコードを修正したことで、これまで正しく動作していた既存の機能が正しく動かなくなることは、ソフトウェアでバグが発生する原因の1つです。ソースコードを修正しなければこのようなことは起こりませんが、これでは根本的な問題解決になりません。ソースコードを修正したことでバグが発生するのは、修正の影響がどこまで及んでいるのかをきちんと把握できていないことが原因です。しかし、ソースコードを修正するたびに既存の機能のテストを毎回手作業で行っていたのでは、時間がいくらあっても足りません。一方、Blenderのアドオンの場合は一般のソフトウェアと異なり、BlenderのバージョンによってAPIが変更されてしまうことで今まで動作していた機能が正しく動作しなくなるという問題もあります。新しいバージョンのBlenderがリリースされる度に、アドオンのすべての機能をテストするのも非常に大変です。

このように、アドオンのテストには想像しているよりも非常に手間がかかることが分かると思います。そこで、毎回同じことを繰り返すようなテストは自動化してしまい、本来の修正作業に集中しましょう。


## コマンドラインからBlenderを実行

BlenderはGUIベースのソフトウェアですので、アドオンの機能が正しく動作していることを動作確認するためにはマウスやキーボードを使った操作が必要になるため、テストを自動化することが難しいと感じるかもしれません。しかし幸いなことに、BlenderはコマンドラインでPythonスクリプトを実行するモード（CUIモード）が標準で備わっているため、CUIモードを活用してアドオンのテストを自動化することができます。

Blenderをコマンドラインから実行するためには、[1-3節](../chapter_01/03_Prepare_Add-on_development_environment.md) で紹介した通り、ターミナルを開きBlenderの実行ファイルを実行します。しかし、[1-3節](../chapter_01/03_Prepare_Add-on_development_environment.md) で紹介した方法では、BlenderがGUIモードで起動してしまいます。CUIモードで起動するためには、```--backgroud``` オプションをつけて実行します。以降の説明では、Blenderの実行ファイルが置かれているパスが ```/path/blender``` とします。

```sh
$ /path/blender --background
```

上記のコマンドを実行すると、BlenderがCUIモードで起動後にBlenderが終了します。しかしこれだけでは、CUIモードでBlenderが起動して終了するだけで意味がありません。CUIモードが強力なのは、オプション ```--python``` の引数に指定したPythonスクリプトを実行できることにあります。例えば、レンダリング処理を実行するPythonスクリプトを作成し、高性能なレンダリングを行うサーバでCUI実行することで、ネットワークレンダリングを行うことができます。また、過去に作成した.blendファイルに対してPythonスクリプトを使って同じ処理を繰り返したい場合にも、コマンドラインから実行することで作業時間を短縮することができます。

ここでは試しに簡単なPythonスクリプトを作成し、BlenderのCUIモードで作成したスクリプトを実行してみましょう。次のスクリプトを作成し、```/path/blender``` と同一ディレクトリに、```run_script_on_cui_mode.py``` の名前で保存します。

```python
a = 50
b = 12
print("a+b=%d" % (a+b) )
```

次にターミナルから以下のコマンドを実行します。

```sh
$ /path/blender --background --python run_script_on_cui_mode.py
```

コマンドを実行すると次のメッセージが出力された後、Blenderが終了します。

```sh
a+b=62
```

このように、BlenderのCUIモードでPythonスクリプトを実行することができます。


## アドオンの動作テストを自動化する方法


### GitHubに登録する

### Travis CIに登録する

### GitHubとTravis CIを連携する

### アドオンテスト用スクリプトの作成

### .travis.ymlの作成

### 作成したアドオンのソースコードをコミット

### テスト結果を確認する


## まとめ




<div id="point"></div>

### ポイント

<div id="point_item"></div>

*
